---
# OpenBSD OpenLDAP role: include task files (run order matters).
# Run full role: --tags openldap (or no tags).
# Run only specific parts: --tags openldap_install, --tags openldap_schema, etc.
- name: Include OpenBSD variables (paths, package names, group)
  ansible.builtin.include_vars: OpenBSD.yml
  tags:
    - openldap
    - openldap_install
    - openldap_schema
    - openldap_overlays
    - openldap_ous_groups
    - openldap_accounts
    - openldap_default_user

- name: Include OpenLDAP SSL (CA and server certificates; run first)
  ansible.builtin.include_tasks: ssl.yml
  tags:
    - openldap
    - openldap_install

- name: Include OpenLDAP install (packages, bootstrap slapd.d, service)
  ansible.builtin.include_tasks: install.yml
  tags:
    - openldap
    - openldap_install

- name: Include OpenLDAP schema (core, OpenSSH LPK, groupWithMember, memberOf-user)
  ansible.builtin.include_tasks: schema.yml
  tags:
    - openldap
    - openldap_schema

- name: Include OpenLDAP overlays (memberof, ppolicy, ACL, TLS apply)
  ansible.builtin.include_tasks: overlays.yml
  tags:
    - openldap
    - openldap_overlays

- name: Include OpenLDAP OUs and groups
  ansible.builtin.include_tasks: ous_groups.yml
  tags:
    - openldap
    - openldap_ous_groups

- name: Include OpenLDAP service accounts (ssh_ldap readonly)
  ansible.builtin.include_tasks: accounts.yml
  tags:
    - openldap
    - openldap_accounts

- name: Include OpenLDAP default user (carpenti) and memberOf refresh
  ansible.builtin.include_tasks: default_user.yml
  tags:
    - openldap
    - openldap_default_user
